<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è¯­é—ªå¡èƒŒå•è¯</title>
    <style>
        /* ğŸ“Œ é¡µé¢æ•´ä½“å¸ƒå±€ */
        body {
            font-family: Arial, "Hiragino Kaku Gothic Pro", "Meiryo", sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f4;
            margin: 0;
        }

        /* ğŸ“Œ é¡¶éƒ¨æ“ä½œæ ï¼ˆé€‰æ‹©æ–‡ä»¶ã€å¯¼å…¥è¯åº“ï¼‰ */
        .controls {
            position: absolute;
            top: 20px;
            display: flex;
            gap: 15px;
            padding: 10px;
            background: #fecf9f;
            border-radius: 10px;
        }

        /* ğŸ“Œ éšè—é»˜è®¤æ–‡ä»¶è¾“å…¥æ¡† */
        input[type="file"] {
            display: none;
        }

        /* ğŸ“Œ é¡¶éƒ¨æŒ‰é’® */
        .custom-file-upload, .import-button {
            background: #FAF0E6;
            color: black;
            padding: 12px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }
        .custom-file-upload:hover, .import-button:hover {
            background: #F5DEB3;
        }

        /* ğŸ“Œ å•è¯å¡ç‰‡æ•´ä½“æ ·å¼ */
        .card {
            width: 50vw;
            height: 45vh;
            perspective: 1000px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .container {
            display: flex;
            flex-direction: row;  /* æ°´å¹³æ’åˆ—å•è¯åˆ—è¡¨å’Œå¡ç‰‡ */
            align-items: center;  /* å‚ç›´å±…ä¸­ */
            justify-content: center;  /* æ°´å¹³å±…ä¸­ */
            width: 100%;
            height: 100vh;  /* ä½¿å®¹å™¨å æ»¡æ•´ä¸ªå±å¹• */
        }

    /* ç¡®ä¿ .word-list åœ¨æœ€å·¦è¾¹ */
        .word-list {
            width: 250px;  /* å›ºå®šå®½åº¦ */
            height: 80vh;  /* é«˜åº¦å è§†çª—çš„ 90% */
            overflow-y: auto;  /* å…è®¸å‚ç›´æ»šåŠ¨ */
            padding: 10px;
            background: #f9f9f9;
            border-right: 2px solid #ddd;  /* è®¾ç½®å³ä¾§è¾¹æ¡†ï¼Œå’Œå¡ç‰‡åˆ†å¼€ */
            text-align: center;
            position: absolute;  /* ä½¿ç”¨ç»å¯¹å®šä½ */
            top: 10%;  /* ç¦»é¡µé¢é¡¶éƒ¨ 10% çš„è·ç¦» */
            left: 10px;  /* ç¦»é¡µé¢å·¦è¾¹ 10px */
        }



   /* ğŸ“Œ å¡ç‰‡å®½åº¦å’Œé«˜åº¦è°ƒæ•´ */
        .card {
            width: 40%;  /* è®¾ç½®å¡ç‰‡å®½åº¦ä¸ºé¡µé¢çš„60% */
            height: 50vh; /* è®¾ç½®å¡ç‰‡é«˜åº¦ä¸ºé¡µé¢çš„60% */
            perspective: 1000px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            margin-left: 40px;   /*ç»™å¡ç‰‡æ·»åŠ å·¦è¾¹è·ï¼Œé¿å…å’Œåˆ—è¡¨ç›´æ¥æ¥è§¦ */
        }


        /* ğŸ“Œ å•è¯åˆ—è¡¨çš„æ¯ä¸€é¡¹ */
        .word-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .word-list li {
            padding: 10px;
            font-size: 18px;
            cursor: pointer;
            border-bottom: 1px solid #ddd;
            transition: background 0.3s;
            display: flex;
            flex-direction: column; /* è®©å‡ååœ¨ä¸Šï¼Œæ±‰å­—å’Œä¸­æ–‡åœ¨ä¸‹ */
        }

        /* ğŸ“Œ å‡åï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰ */
        .word-list .reading {
            font-size: 20px;
            font-weight: bold;
            color: black;
        }

        /* ğŸ“Œ æ±‰å­—å’Œä¸­æ–‡ï¼ˆé»˜è®¤éšè—ï¼Œç‚¹å‡»åæ˜¾ç¤ºï¼‰ */
        .word-list .extra-info {
            display: flex;
            justify-content: center;
             gap: 8px;  /* é—´è·ç¼©å° */
             align-items: center;
        }

        /* ğŸ“Œ æ±‰å­—ï¼ˆé»‘è‰²ï¼‰ */
        .word-list .kanji {
            font-weight: bold;
            color: rgb(161, 19, 19);
        }

        /* ğŸ“Œ ä¸­æ–‡é‡Šä¹‰ï¼ˆç°è‰²ï¼Œå­—ä½“å°ä¸€å·ï¼‰ */
        .word-list .definition {
            font-size: 14px;
            color: gray;
        }





        /* ğŸ“Œ å¡ç‰‡ç¿»è½¬æ•ˆæœ */
        .card-inner {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        /* ğŸ“Œ æ­£é¢ï¼ˆå•è¯ï¼‰& åé¢ï¼ˆé‡Šä¹‰ï¼‰ */
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 36px;
            font-weight: bold;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            padding: 20px;
        }

        /* ğŸ“Œ åé¢èƒŒæ™¯è‰² */
        .card-back {
            transform: rotateY(180deg);
            background: #f1d9b5;
        }
        /* ğŸ“Œ é‡Šä¹‰æ–‡å­—ï¼ˆä¸­æ–‡ï¼‰ */
        #definition {
            font-size: 25px;  /* å­—ä½“å¤§å°è°ƒæ•´ */
            color: gray;      /* é¢œè‰²å˜ç° */
            margin-top: 10px;
            text-align: center;
            width: 80%;
        }

        /* ğŸ“Œ å‡åï¼ˆé˜…è¯»ï¼‰éƒ¨åˆ† */
        .reading {
            font-size: 44px;
            color: rgb(0, 0, 0);
            margin-top: 14px;
        }

        /* ğŸ“Œ æŒ‰é’®æ•´ä½“å¸ƒå±€ */
        .buttons {
            margin-top: 20px;
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        /* ğŸ“Œ ä¸»è¦åŠŸèƒ½æŒ‰é’® */
        .prev-button, .unknown-button, .review-button {
            background: #ecaf73;
            color: black;
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }
        .prev-button:hover, .unknown-button:hover, .review-button:hover {
            background: #FAF0E6;
        }

        /* ğŸ“Œ å¤ä¹ æŒ‰é’® */
        .review-button {
            background: #4caf50;
        }
        .review-button:hover {
            background: #388e3c;
        }

        /* ğŸ“Œ å‘éŸ³æŒ‰é’® */
        .speak-button {
            background: #ffcc99;
            color: black;
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }
        .speak-button:hover {
            background: #ffb366;
        }
    </style>
</head>
<body>

    <!-- è¯åº“å¯¼å…¥æŒ‰é’® -->
    <div class="controls">
        <label for="fileInput" class="custom-file-upload">ğŸ“‚ é€‰æ‹©æ–‡ä»¶</label>
        <input type="file" id="fileInput" accept=".csv,.json">
        <button class="import-button" onclick="importWordList()">ğŸ“¥ å¯¼å…¥è¯åº“</button>
        <!-- <button class="prev-button" onclick="prevWord()">â¬… å›é€€</button> -->
        <button class="unknown-button" onclick="markAsUnknown()">âŒ ä¸è®¤è¯†</button>
        <button class="review-button" onclick="reviewUnknownWords()">ğŸ”„ å¤ä¹ </button>
    </div>

    <!-- âœ… .container ç”¨æ¥åŒ…è£¹å•è¯åˆ—è¡¨ + å•è¯å¡ç‰‡ -->
    <div class="container">
        <!-- ğŸ“Œ å•è¯åˆ—è¡¨ï¼ˆæœ€å·¦è¾¹ï¼‰ -->
        <div class="word-list">
            <h3>å•è¯åˆ—è¡¨</h3>
            <ul id="wordList"></ul>
        </div>

        <!-- ğŸ“Œ å•è¯å¡ç‰‡ï¼ˆåœ¨å³è¾¹ï¼‰ -->
        <div class="card" onclick="flipCard()">
            <div class="card-inner">
                <div class="card-front">
                    <div id="reading" class="reading">ï¼ˆå‡åï¼‰</div>
                    <button class="speak-button" onclick="speakWord(event)">ğŸ”Š å‘éŸ³</button>
                </div>
                <div class="card-back">
                    <div id="word">æ±‰å­—</div>
                    <div id="definition">é‡Šä¹‰...</div>
                </div>
            </div>
        </div>
    </div>


    <script>
        let words = [];
        let unknownWords = [];
        let currentIndex = 0;

        function importWordList() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert("âš ï¸ è¯·é€‰æ‹©ä¸€ä¸ª CSV æˆ– JSON è¯åº“æ–‡ä»¶ï¼");
                return;
            }

            const reader = new FileReader();

            reader.onload = function (event) {
                const content = event.target.result;
                try {
                    words = file.name.endsWith(".csv") ? parseCSV(content) : JSON.parse(content);
                    currentIndex = 0;
                    loadWord();
                    alert("âœ… è¯åº“å¯¼å…¥æˆåŠŸï¼");
                } catch (error) {
                    alert("âŒ æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ ¼å¼ï¼");
                }
            };

            reader.readAsText(file);
        }

        function parseCSV(csvText) {
            return csvText.trim().split("\n").map(row => {
                const [word, reading, definition] = row.split(",");
                return { word: word.trim(), reading: reading.trim(), definition: definition.trim() };
            });
        }

 
        function updateWordList() {
            const wordListContainer = document.getElementById('wordList');
            wordListContainer.innerHTML = ''; // æ¸…ç©ºæ—§åˆ—è¡¨

            words.forEach((wordObj, index) => {
                const listItem = document.createElement('li');

                // âœ… å‡åï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰
                const readingSpan = document.createElement('span');
                readingSpan.innerText = wordObj.reading;
                readingSpan.classList.add('reading');

                // âœ… æ±‰å­— + ä¸­æ–‡ï¼ˆé»˜è®¤éšè—ï¼‰
                const extraInfo = document.createElement('div');
                extraInfo.classList.add('extra-info');
                extraInfo.style.display = 'none'; // ğŸš€ é»˜è®¤éšè—

                const kanjiSpan = document.createElement('span');
                kanjiSpan.innerText = wordObj.word;
                kanjiSpan.classList.add('kanji');
                kanjiSpan.style.display = 'none'; // ğŸš€ é»˜è®¤éšè—

                const definitionSpan = document.createElement('span');
                definitionSpan.innerText = wordObj.definition;
                definitionSpan.classList.add('definition');
                definitionSpan.style.display = 'none'; // ğŸš€ é»˜è®¤éšè—

                extraInfo.appendChild(kanjiSpan);
                extraInfo.appendChild(definitionSpan);

                listItem.appendChild(readingSpan);
                listItem.appendChild(extraInfo);

                // âœ… ç‚¹å‡»äº‹ä»¶ï¼š**åŒæ—¶æ›´æ–° `å•è¯å¡ç‰‡` å’Œ `é‡Šä¹‰`**
                listItem.onclick = function () {
                    if (currentIndex !== index) {
                        // ğŸš€ **ç‚¹å‡»ä¸åŒå•è¯æ—¶**
                        currentIndex = index;
                        loadWord(); // âœ… æ›´æ–° `å•è¯å¡ç‰‡`
                        
                        // ğŸš€ **åŒæ—¶å±•å¼€ `é‡Šä¹‰`**
                        extraInfo.style.display = 'flex';
                        kanjiSpan.style.display = 'inline';
                        definitionSpan.style.display = 'inline';
                    } else {
                        // ğŸš€ **ç‚¹å‡»ç›¸åŒå•è¯æ—¶ï¼Œä»…åˆ‡æ¢ `é‡Šä¹‰`**
                        const isOpen = extraInfo.style.display === 'flex';
                        extraInfo.style.display = isOpen ? 'none' : 'flex';
                        kanjiSpan.style.display = isOpen ? 'none' : 'inline';
                        definitionSpan.style.display = isOpen ? 'none' : 'inline';
                    }
                };

                wordListContainer.appendChild(listItem);
            });
        }






        // ğŸ“Œ ç¡®ä¿ loadWord() æ›´æ–°å•è¯åˆ—è¡¨
        function loadWord() {
            if (words.length > 0) {
                document.getElementById('reading').innerText = words[currentIndex].reading || 'æš‚æ— å‡å';
                document.getElementById('word').innerText = words[currentIndex].word;
                document.getElementById('definition').innerText = words[currentIndex].definition || "æš‚æ— é‡Šä¹‰";
                speakWord();
            } else {
                document.getElementById('reading').innerText = "";
                document.getElementById('word').innerText = "æš‚æ— å•è¯";
                document.getElementById('definition').innerText = "è¯·å¯¼å…¥è¯åº“";
            }
            updateWordList(); // âœ… ä¿æŒåˆ—è¡¨æ›´æ–°
        }



         function speakWord() {
            const utterance = new SpeechSynthesisUtterance(words[currentIndex].word);
            utterance.lang = "ja-JP";

            // âœ… å–æ¶ˆå½“å‰è¯­éŸ³ï¼Œé˜²æ­¢æ‰“æ–­
            speechSynthesis.cancel();  

            const voices = speechSynthesis.getVoices();
            const japaneseVoice = voices.find(voice => voice.lang === "ja-JP");

            if (japaneseVoice) {
                utterance.voice = japaneseVoice;
            }

            speechSynthesis.speak(utterance);
        }
        document.addEventListener("click", function(event) {
            if (event.target.classList.contains("speak-button")) {
                event.stopPropagation(); // âœ… é˜»æ­¢ç‚¹å‡»äº‹ä»¶å†’æ³¡ï¼Œé¿å…ç¿»è½¬å¡ç‰‡
                speakWord();
            }
        });




        function flipCard() {
            document.querySelector('.card').classList.toggle('flipped');
        }

        function prevWord() {
            if (currentIndex > 0) {
                currentIndex--;
                loadWord();
            }
        }

        function markAsUnknown() {
            if (!unknownWords.includes(words[currentIndex])) {
                unknownWords.push(words[currentIndex]);
            }
            currentIndex = (currentIndex + 1) % words.length;
            loadWord();
        }

        function reviewUnknownWords() {
            if (unknownWords.length > 0) {
                words = unknownWords;
                unknownWords = [];
                currentIndex = 0;
                loadWord();
            }
        }
                document.addEventListener('keydown', (event) => {
            if (event.key === "ArrowRight" && words.length > 0) {
                currentIndex = (currentIndex + 1) % words.length;
                loadWord();
            }
            if (event.key === "ArrowLeft" && words.length > 0) {
                currentIndex = (currentIndex - 1 + words.length) % words.length;
                loadWord();
            }
            if (event.key === "ArrowDown") {
                // ğŸš€ **ç‚¹å‡»ä¸‹é”®ï¼Œç¿»è½¬å¡ç‰‡**
                document.querySelector('.card').classList.toggle('flipped');
            }
        });


    </script>
</body>
</html>